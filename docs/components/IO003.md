---
id: IO003
name: KY-040
title: KY-040 Rotary Encoder Module
category: IO
tags:
  - rotary-encoder
  - quadrature
  - input
  - push-button
  - ec11
  - module
  - 20-ppr
short: "Incremental rotary encoder • 20 steps • push‑button"
use: "UI knob + press input"
---

# KY-040 - IO003

Compact **incremental rotary encoder module** (usually built around an ALPS **EC11** encoder) with an **integrated push‑button**.  
Use it as a **UI knob** to scroll menus, set values, or navigate—unlike a potentiometer it **rotates continuously** and outputs **quadrature pulses (CLK/DT)** to indicate **steps** and **direction**.

## Links

- **Where to buy:** [AliExpress](https://www.aliexpress.com/item/1005005559054521.html)
- **Datasheet:** [EC11 (typical encoder used on KY‑040 boards)](https://www.avnet.com/opasdata/d120001/medias/docus/196/Alps-Alpine-EC11-Series-EN-Datasheet.pdf)
- **Tutorial:** [uPesy – Rotary Encoder on ESP32](https://www.upesy.com/blogs/tutorials/rotary-encoder-esp32-with-arduino-code)

## Specifications

- **Steps per revolution:** ~20 (detents), incremental (quadrature A/B)
- **Push‑button:** momentary, active‑low on **SW**
- **Supply voltage:** works at **3.3–5 V** (many KY‑040 boards include pull‑ups to VCC – power at **3.3 V** for ESP32‑safe logic)
- **Typical encoder family:** ALPS **EC11** (variants exist)
- **Shaft length:** ~20 mm (per listing)

> Notes: Some vendors advertise “20 pulses/turn”; others “20 detents”. Expect minor variation between batches. If exact counts matter, measure on your unit.

## Pinout & Addresses (common breakout labels)

- **CLK** – Channel A (interrupt‑friendly GPIO)
- **DT** – Channel B
- **SW** – Push‑button output (active‑low)
- **+ / VCC** – Module supply (**use 3.3 V with ESP32**)
- **GND** – Ground

## Wiring

- Power **VCC → 3.3 V**, **GND → GND** (recommended with ESP32 to avoid 5 V logic).  
- **CLK → GPIO 25** (any input pin; interrupt‑capable helps)  
- **DT  → GPIO 26**  
- **SW  → GPIO 27** (enable input pull‑up if your board lacks one)

Most KY‑040 boards already have ~10 kΩ pull‑ups to VCC on **CLK/DT/SW**. If so, **do not enable internal pull‑ups**; instead ensure the board is powered at **3.3 V** so logic levels are safe.

## Gotchas

- **Bounce:** mechanical bounce causes false counts; do simple edge filtering/debouncing in code.  
- **5 V warning:** Many modules pull up to VCC—if powered at **5 V**, signals will be 5 V and **not ESP32‑safe**. Use **3.3 V**.  
- **Wiring length:** long leads pick up noise; keep short or add small caps (e.g., 0.01–0.1 µF) if needed.  
- **Count per detent varies** by encoder variant; treat counts as approximate.

## How to use

Below is a minimal **Arduino** sketch for **ESP32** using an interrupt on **CLK** and reading **DT** to determine direction. The push‑button **SW** is debounced in software.

```cpp
// KY-040 on ESP32 minimal example
// CLK -> GPIO25, DT -> GPIO26, SW -> GPIO27, VCC -> 3V3, GND -> GND

volatile long encoderCount = 0;
const int PIN_CLK = 25;
const int PIN_DT  = 26;
const int PIN_SW  = 27;

volatile int lastCLK = 0;
unsigned long lastButtonMs = 0;

void IRAM_ATTR onCLK() {
  int clkState = digitalRead(PIN_CLK);
  int dtState  = digitalRead(PIN_DT);
  // Count on rising edge only
  if (clkState == HIGH) {
    if (dtState == LOW) encoderCount++;  // CW
    else                encoderCount--;  // CCW
  }
}

void setup() {
  Serial.begin(115200);
  pinMode(PIN_CLK, INPUT); // leave INPUT if board has external pull-ups
  pinMode(PIN_DT,  INPUT);
  pinMode(PIN_SW,  INPUT_PULLUP); // many KY-040s have pull-up; INPUT_PULLUP is fine too
  attachInterrupt(digitalPinToInterrupt(PIN_CLK), onCLK, CHANGE);
}

void loop() {
  static long lastReported = 0;
  if (encoderCount != lastReported) {
    long v = encoderCount;
    lastReported = v;
    Serial.printf("Count: %ld\n", v);
  }

  // Simple button read with debounce
  unsigned long now = millis();
  if (digitalRead(PIN_SW) == LOW && (now - lastButtonMs) > 50) {
    lastButtonMs = now;
    Serial.println("Button press!");
  }
}
```

Libraries: none required. For advanced handling (acceleration, better debouncing), try **Encoder** (Paul Stoffregen) or **AiEsp32RotaryEncoder**.

---

*QR for printing will appear here after you run the script:*

![QR sticker](stickers/IO003.png)
